<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="941px" preserveAspectRatio="none" style="width:1094px;height:941px;" version="1.1" viewBox="0 0 1094 941" width="1094px" zoomAndPan="magnify"><defs><filter height="300%" id="fh9m2yqbjkyye" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="188" x="451" y="28.708">Order refund process</text><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="783.2266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="257.5" y="106.3828"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="135.5156"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="394.7109"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="303.625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="467.7813"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="815.3438"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="230.2266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="661.5" y="512.0469"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="191.0938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="551.1797"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="291" x="10" y="296.1797"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="496.0313" style="stroke:#000000;stroke-width:2.0;" width="856" x="224" y="356.4453"/><rect fill="#FFFFFF" height="347.5625" style="stroke:none;stroke-width:1.0;" width="856" x="224" y="431.8438"/><rect fill="#FFFFFF" height="73.0703" style="stroke:none;stroke-width:1.0;" width="856" x="224" y="779.4063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="59" x2="59" y1="75.25" y2="898.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="262" x2="262" y1="75.25" y2="898.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="487.5" x2="487.5" y1="75.25" y2="898.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="666" x2="666" y1="75.25" y2="898.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="928.5" x2="928.5" y1="552.6953" y2="898.6094"/><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="75" x="20" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="27" y="59.9482">Operator</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="75" x="20" y="897.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="27" y="917.6045">Operator</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="53" x="234" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="241" y="59.9482">Client</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="53" x="234" y="897.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="241" y="917.6045">Client</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="58" x="456.5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="463.5" y="59.9482">Server</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="58" x="456.5" y="897.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="463.5" y="917.6045">Server</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="79" x="625" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="632" y="59.9482">Stripe API</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="79" x="625" y="897.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="632" y="917.6045">Stripe API</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="157" x="848.5" y="897.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="855.5" y="917.6045">Stripe Refund Object</text><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="783.2266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="257.5" y="106.3828"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="135.5156"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="394.7109"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="303.625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="467.7813"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="482.5" y="815.3438"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="230.2266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="661.5" y="512.0469"/><rect fill="#FFFFFF" filter="url(#fh9m2yqbjkyye)" height="191.0938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="551.1797"/><polygon fill="#A80036" points="245.5,102.3828,255.5,106.3828,245.5,110.3828,249.5,106.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="251.5" y1="106.3828" y2="106.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="66.5" y="101.3169">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="79.5" y="101.3169">Open closed orders</text><polygon fill="#A80036" points="470.5,131.5156,480.5,135.5156,470.5,139.5156,474.5,135.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="267.5" x2="476.5" y1="135.5156" y2="135.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="274.5" y="130.4497">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="287.5" y="130.4497">Get closed orders</text><polygon fill="#A80036" points="278.5,160.6484,268.5,164.6484,278.5,168.6484,274.5,164.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272.5" x2="486.5" y1="164.6484" y2="164.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="284.5" y="159.5825">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="297.5" y="159.5825">Return list of closed orders</text><polygon fill="#A80036" points="70.5,189.7813,60.5,193.7813,70.5,197.7813,66.5,193.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="256.5" y1="193.7813" y2="193.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="76.5" y="188.7153">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="89.5" y="188.7153">Display closed orders</text><polygon fill="#A80036" points="245.5,218.9141,255.5,222.9141,245.5,226.9141,249.5,222.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="251.5" y1="222.9141" y2="222.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="66.5" y="217.8481">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="79.5" y="217.8481">Select order</text><polygon fill="#A80036" points="70.5,248.0469,60.5,252.0469,70.5,256.0469,66.5,252.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="256.5" y1="252.0469" y2="252.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="76.5" y="246.981">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="89.5" y="246.981">Display order information</text><polygon fill="#A80036" points="245.5,277.1797,255.5,281.1797,245.5,285.1797,249.5,281.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="251.5" y1="281.1797" y2="281.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="66.5" y="276.1138">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="79.5" y="276.1138">Select refund</text><path d="M10,296.1797 L80,296.1797 L80,303.1797 L70,313.1797 L10,313.1797 L10,296.1797 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="291" x="10" y="296.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="25" y="309.2466">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="98" x="95" y="308.3901">[partial refund]</text><polygon fill="#A80036" points="245.5,330.4453,255.5,334.4453,245.5,338.4453,249.5,334.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="251.5" y1="334.4453" y2="334.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="66.5" y="329.3794">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="79.5" y="329.3794">Select refund amount</text><path d="M224,356.4453 L288,356.4453 L288,363.4453 L278,373.4453 L224,373.4453 L224,356.4453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="496.0313" style="stroke:#000000;stroke-width:2.0;" width="856" x="224" y="356.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="239" y="369.5122">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126" x="303" y="368.6558">[order paid in cash]</text><polygon fill="#A80036" points="470.5,390.7109,480.5,394.7109,470.5,398.7109,474.5,394.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="267.5" x2="476.5" y1="394.7109" y2="394.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="274.5" y="389.645">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="287.5" y="389.645">Mark order as refunded</text><polygon fill="#A80036" points="278.5,419.8438,268.5,423.8438,278.5,427.8438,274.5,423.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="272.5" x2="486.5" y1="423.8438" y2="423.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="284.5" y="418.7778">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="306.5" y="418.7778">Order marked as refunded</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="224" x2="1080" y1="432.8438" y2="432.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="140" x="229" y="443.0542">[order paid with card]</text><polygon fill="#A80036" points="470.5,463.7813,480.5,467.7813,470.5,471.7813,474.5,467.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="267.5" x2="476.5" y1="467.7813" y2="467.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="274.5" y="462.7153">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="296.5" y="462.7153">Initialize refund</text><polygon fill="#A80036" points="649.5,508.0469,659.5,512.0469,649.5,516.0469,653.5,512.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="492.5" x2="655.5" y1="512.0469" y2="512.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="499.5" y="499.4146">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="521.5" y="491.8481">refund</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="521.5" y="506.981">payment_intent_id</text><line style="stroke:#A80036;stroke-width:1.0;" x1="846.5" x2="836.5" y1="541.1797" y2="537.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="846.5" x2="836.5" y1="541.1797" y2="545.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="671.5" x2="847.5" y1="541.1797" y2="541.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="678.5" y="536.1138">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="700.5" y="536.1138">Create refund object</text><rect fill="#FEFECE" filter="url(#fh9m2yqbjkyye)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="157" x="848.5" y="520.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="855.5" y="540.042">Stripe Refund Object</text><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="912" y1="586.4766" y2="582.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="912" y1="586.4766" y2="590.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="671.5" x2="923" y1="586.4766" y2="586.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="678.5" y="581.4106">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="700.5" y="581.4106">Mark refund as pending</text><line style="stroke:#A80036;stroke-width:1.0;" x1="934" x2="976" y1="615.6094" y2="615.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="976" x2="976" y1="615.6094" y2="628.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="935" x2="976" y1="628.6094" y2="628.6094"/><polygon fill="#A80036" points="945,624.6094,935,628.6094,945,632.6094,941,628.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="941" y="610.5435">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="963" y="610.5435">Push funds back</text><polygon fill="#A80036" points="682.5,673.875,672.5,677.875,682.5,681.875,678.5,677.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="676.5" x2="923" y1="677.875" y2="677.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="688.5" y="672.8091">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="710.5" y="672.8091">succeeded</text><path d="M939,641.6094 L939,696.6094 L1066,696.6094 L1066,651.6094 L1056,641.6094 L939,641.6094 " fill="#FBFB77" filter="url(#fh9m2yqbjkyye)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1056,641.6094 L1056,651.6094 L1066,651.6094 L1056,641.6094 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="945" y="658.6763">settlement may</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="945" y="673.8091">still take days</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="945" y="688.9419">at the bank level</text><polygon fill="#A80036" points="503.5,738.2734,493.5,742.2734,503.5,746.2734,499.5,742.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="497.5" x2="665.5" y1="742.2734" y2="742.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="509.5" y="729.6411">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="531.5" y="722.0747">succeeded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="531.5" y="737.2075">(mark as refunded)</text><polygon fill="#A80036" points="278.5,767.4063,268.5,771.4063,278.5,775.4063,274.5,771.4063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="272.5" x2="486.5" y1="771.4063" y2="771.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="284.5" y="766.3403">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="306.5" y="766.3403">Order marked as refunded</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="224" x2="1080" y1="780.4063" y2="780.4063"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="229" y="790.6167">[gift-card]</text><polygon fill="#A80036" points="470.5,811.3438,480.5,815.3438,470.5,819.3438,474.5,815.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="267.5" x2="476.5" y1="815.3438" y2="815.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="274.5" y="810.2778">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="296.5" y="810.2778">Add funds to gift_card_id</text><polygon fill="#A80036" points="278.5,840.4766,268.5,844.4766,278.5,848.4766,274.5,844.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="272.5" x2="486.5" y1="844.4766" y2="844.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="284.5" y="839.4106">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="306.5" y="839.4106">Order marked as refunded</text><polygon fill="#A80036" points="70.5,876.6094,60.5,880.6094,70.5,884.6094,66.5,880.6094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="256.5" y1="880.6094" y2="880.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="76.5" y="875.5435">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="98.5" y="875.5435">Refund success</text><!--MD5=[4392cc0f43175519e34ae837fc90f112]
@startuml
 
title Order refund process
participant Operator
participant Client
participant Server
participant "Stripe API" as stripe

autonumber

Operator->Client: Open closed orders
activate Client
Client->Server: Get closed orders
activate Server
Server- ->Client: Return list of closed orders
deactivate Server
Client- ->Operator: Display closed orders
Operator->Client: Select order
Client- ->Operator: Display order information
Operator->Client: Select refund
opt partial refund
Operator->Client: Select refund amount

end
 
alt order paid in cash
    Client->Server: Mark order as refunded
activate Server
    Server->Client: Order marked as refunded
deactivate Server

else order paid with card 
    Client->Server: Initialize refund
activate Server
    Server->stripe: refund\npayment_intent_id
    activate stripe
    create "Stripe Refund Object" as refund
    stripe->>refund: Create refund object
    activate refund
    stripe->>refund: Mark refund as pending
    refund->refund: Push funds back
    refund- ->stripe: succeeded
    note right
    settlement may 
    still take days
    at the bank level
    end note
    stripe- ->Server: succeeded\n(mark as refunded)
    deactivate stripe
    deactivate refund
    Server->Client: Order marked as refunded
deactivate Server

else gift-card
    Client->Server: Add funds to gift_card_id
activate Server
    Server->Client: Order marked as refunded
deactivate Server
end
    Client- ->Operator: Refund success 
@enduml

PlantUML version 1.2021.00(Sun Jan 10 12:25:05 EET 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>