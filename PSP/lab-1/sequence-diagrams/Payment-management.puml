title Payment System

loop Until total sum is paid
  Operator->Client: Select payment method, amount
  alt Cash Payment
    Client->Server: Upload cash payment info
    Server-->Client: Confirm cash payment
    Client-->Operator: Show remaining balance
  else Card Payment
    Client->Server: Upload card payment info
    Server->Stripe: Create payment intent
    alt Payment Authorized
      Stripe-->Server: Payment authorized
      Server-->Client: Confirm card payment
      Client-->Operator: Show remaining balance
    else Payment Declined
      Stripe-->Server: Payment declined
      Server-->Client: Decline
      Client-->Operator: Show error, retry
    end
  else GiftCard Payment
    Client->Server: Upload giftcard payment info
    Server->Server: Reduce gift card remaining balance
    alt Payment Accepted
      Server-->Client: Confirm giftcard payment
      Client-->Operator: Show remaining balance
    else Insufficient Balance
      Server-->Client: Decline payment
      Client-->Operator: Show error, retry
    end
  end
end

Operator->Client: Close order
Client->Server: Upload closed order
Server->Server: Generate receipt
Server-->Client: Order closed
Client-->Operator: Provide receipt
